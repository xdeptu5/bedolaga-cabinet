name: Auto Sync Fork

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    # –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å, —á—Ç–æ–±—ã –ì–∏—Ç—Ö–∞–± —Ä–∞–∑—Ä–µ—à–∏–ª –ø—É—à –≤ —Ç–≤–æ—é –≤–µ—Ç–∫—É
    permissions:
      contents: write
    
    steps:
      - name: Checkout target repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # –ö–∞—á–∞–µ–º –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è –º–µ—Ä–¥–∂–∞

      - name: Sync logic
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          
          # –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑—Ä–∞–±–∞ –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫
          git remote add upstream https://github.com/BEDOLAGA-DEV/bedolaga-cabinet.git
          git fetch upstream main
          
          # –ü—ã—Ç–∞–µ–º—Å—è —Å–ª–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
          git merge upstream/main --no-edit || (echo "CONFLICT DETECTED" && exit 1)
          
          # –ï—Å–ª–∏ –≤—Å–µ –æ–∫ ‚Äî –ø—É—à–∏–º –≤ —Ç–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
          git push origin main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Send Notification
        if: always()
        run: |
          # –í—ã–±–∏—Ä–∞–µ–º –∏–∫–æ–Ω–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Å–ø–µ—Ö–∞
          if [ "${{ job.status }}" = "success" ]; then
            ICON="‚úÖ"
            STATUS="Sync Successful"
          else
            ICON="‚ùå"
            STATUS="Sync Failed (Conflict or Error)"
          fi

          MESSAGE="<b>Safexess VPN Bot</b>%0A$ICON <b>$STATUS</b>%0A%0Aüì¶ <b>Repository:</b> ${{ github.repository }}%0Aüî® <b>Workflow:</b> ${{ github.workflow }}"
          
          curl -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.TELEGRAM_CHAT_ID }}" \
          -d "message_thread_id=${{ secrets.TELEGRAM_TOPIC_ID }}" \
          -d "parse_mode=HTML" \
          -d "text=$MESSAGE"
